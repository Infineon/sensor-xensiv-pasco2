<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XENSIV™ PAS CO2 Library: PASCO2 library API usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="IFXCYP_one-line.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XENSIV™ PAS CO2 Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('section_pasco2_configuration.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PASCO2 library API usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Application Programming Interface (API) routines allow controlling and executing specific tasks using this binary interface.</p>
<p>The PASCO2 API is described in the following sections:</p><ul>
<li><a class="el" href="group__group__pasco2__high__level.html">High Level</a></li>
<li><a class="el" href="group__group__pasco2__structures.html">Structures</a></li>
<li><a class="el" href="group__group__pasco2__macros.html">Macros</a></li>
</ul>
<p>PASCO2 operates on the top of I2C driver, Please refer to the PDL API Reference Manual for more details about I2C driver. Following the steps described below, the user can create a simple application which displays the CO2 concentration on serial terminal.</p>
<p>Create a ModusToolbox application and include this library. </p><div class="image">
<img src="library_manager.png" alt="library_manager.png" width="800px"/>
<div class="caption">
Library Manager</div></div>
 <p>Include the pasco2 library header into application source file and define the context object for pasco2 library.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;mtb_pasco2.h&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="structmtb__pasco2__context__t.html">mtb_pasco2_context_t</a> mtb_pasco2_context;</div></div><!-- fragment --><p>To reduce the power consumption, the sensor remains in off state after power-up and can be turned on by initializing and setting the PASCO2_POWER_SWITCH output pin to High. </p><div class="fragment"><div class="line"><span class="preprocessor">#define PASCO2_POWER_SWITCH  (P10_5)</span></div><div class="line"><span class="comment">// Initialize and enable the power to the sensor </span></div><div class="line">cyhal_gpio_init(PASCO2_POWER_SWITCH, CYHAL_GPIO_DIR_OUTPUT, CYHAL_GPIO_DRIVE_STRONG, <span class="keyword">true</span>);</div></div><!-- fragment --><p>The sensor can communicate with MCU using either UART or I2C channels. However, the current version of library only supports I2C interface which is enabled by writing zero to PASCO2_PSEL pin. </p><div class="fragment"><div class="line"><span class="preprocessor">#define PASCO2_PSEL    (P5_3)</span></div><div class="line"><span class="comment">// Initialize and enable I2C channel of the sensor</span></div><div class="line">cyhal_gpio_init(PASCO2_PSEL, CYHAL_GPIO_DIR_OUTPUT, CYHAL_GPIO_DRIVE_STRONG, <span class="keyword">false</span>);</div><div class="line"><span class="comment">// 1 Second delay after turning on the sensor is required by sensor to be ready for communication </span></div></div><!-- fragment --><p>Initialize I2C channel for communication with sensor.</p>
<div class="fragment"><div class="line"> <span class="comment">// Initialize I2C channel for CO2 sensor communication </span></div><div class="line"> cy_rslt_t result;</div><div class="line"> cyhal_i2c_t cyhal_i2c;</div><div class="line"> cyhal_i2c_cfg_t i2c_config = {.is_slave = <span class="keyword">false</span>, .address = 0, .frequencyhal_hz = 100000}; <span class="comment">// sensor address is not required here</span></div><div class="line"> result = cyhal_i2c_init(&amp;cyhal_i2c, CYBSP_I2C_SDA, CYBSP_I2C_SCL, NULL);</div><div class="line"> CY_ASSERT(result == CY_RSLT_SUCCESS);</div><div class="line">result = cyhal_i2c_configure(&amp;cyhal_i2c, &amp;i2c_config);</div><div class="line"> CY_ASSERT(result == CY_RSLT_SUCCESS);</div></div><!-- fragment --><p> Add following lines to initialize PAS CO2 sensor as well as pressure sensor with default parameters.</p>
<div class="fragment"><div class="line"><span class="comment">// Initialize PAS CO2 sensor with default parameter values </span></div><div class="line">result = <a class="code" href="group__group__pasco2__high__level.html#gaeb2755b60a51e81aceb706c8e3310ae7">mtb_pasco2_init</a>(&amp;mtb_pasco2_context, &amp;cyhal_i2c);</div><div class="line">CY_ASSERT(result == CY_RSLT_SUCCESS);</div></div><!-- fragment --><p>To read the CO2 PPM values following code snippet can be used. Please note that the function provides different results from the sensor as described below:</p>
<p><b>Result Success:</b> New CO2 value is returned by the sensor.<br />
 <b>Result Info:</b> Sensor is busy in internal processing and new value could not be fetched.<br />
 <b>Result Warning:</b> This indicates there is an issue with the sensor. If this error persists, Please refer to the datasheet for more information.<br />
 </p><div class="fragment"><div class="line"><span class="comment">// variable to hold CO2 value</span></div><div class="line">uint16_t ppm = 0;</div><div class="line"></div><div class="line"><span class="comment">// get new value from sensor</span></div><div class="line">result = <a class="code" href="group__group__pasco2__high__level.html#gad40fb1f1a69a289076c97c94ed3b2716">mtb_pasco2_get_ppm</a>(&amp;mtb_pasco2_context, &amp;ppm);</div><div class="line"><span class="keywordflow">if</span> (result == CY_RSLT_SUCCESS)</div><div class="line">{</div><div class="line">  <span class="comment">// New CO2 value is successfully read from the sensor and print it to serial console </span></div><div class="line">  printf(<span class="stringliteral">&quot;CO2 PPM Level: %d\r\n&quot;</span>, ppm);</div><div class="line">  </div><div class="line">  <span class="comment">// add delay before polling for new value i.e same as measurement period </span></div><div class="line">  <span class="comment">// delay(); </span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (CY_RSLT_GET_TYPE(result) == CY_RSLT_TYPE_INFO)</div><div class="line">{</div><div class="line">  <span class="comment">// Sensor gave other information instead of CO2 value </span></div><div class="line">  <span class="keywordflow">if</span> (CY_RSLT_GET_CODE(result) == <a class="code" href="group__group__pasco2__macros.html#ga6f2a994145d3dace941773101d9c9751">MTB_PASCO2_PPM_PENDING</a>)</div><div class="line">  {</div><div class="line">   <span class="comment">// New value is not available yet </span></div><div class="line">    printf(<span class="stringliteral">&quot;CO2 PPM value is not ready\r\n&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CY_RSLT_GET_CODE(result) == <a class="code" href="group__group__pasco2__macros.html#ga0b3b07cc4399dc23b187c09725e8f6b4">MTB_PASCO2_SENSOR_BUSY</a>)</div><div class="line">  {</div><div class="line">    <span class="comment">// Sensor is busy in internal processing </span></div><div class="line">    printf(<span class="stringliteral">&quot;CO2 sensor is busy\r\n&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    printf(<span class="stringliteral">&quot;An unexpected occurred when accessing the CO2 sensor\r\n&quot;</span>);</div><div class="line">  }</div><div class="line">  </div><div class="line">  <span class="comment">// Sensor is polled in 1 second again </span></div><div class="line">  <span class="comment">// delay();</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (CY_RSLT_GET_TYPE(result) == CY_RSLT_TYPE_WARNING)</div><div class="line">{</div><div class="line">  <span class="comment">// Sensor gave a warning regarding over-voltage, temperature, or communication problem </span></div><div class="line">  <span class="keywordflow">switch</span> (CY_RSLT_GET_CODE(result))</div><div class="line">  {</div><div class="line">  <span class="keywordflow">case</span> <a class="code" href="group__group__pasco2__macros.html#gab637db3af31db73de068c5977b8460f5">MTB_PASCO2_VOLTAGE_ERROR</a>:</div><div class="line">    <span class="comment">// Sensor detected over-voltage problem </span></div><div class="line">    printf(<span class="stringliteral">&quot;CO2 Sensor Over-Voltage Error\r\n&quot;</span>);</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">  <span class="keywordflow">case</span> <a class="code" href="group__group__pasco2__macros.html#ga295c42ec74acaba26de5213a73431b18">MTB_PASCO2_TEMPERATURE_ERROR</a>:</div><div class="line">    <span class="comment">// Sensor detected temperature problem </span></div><div class="line">    printf(<span class="stringliteral">&quot;CO2 Sensor Temperature Error\r\n&quot;</span>);</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">  <span class="keywordflow">case</span> <a class="code" href="group__group__pasco2__macros.html#gae3cc7ccf303faa6bf7f94c77642d92b7">MTB_PASCO2_COMMUNICATION_ERROR</a>:</div><div class="line">    <span class="comment">// Sensor detected communication problem with MCU </span></div><div class="line">    printf(<span class="stringliteral">&quot;CO2 Sensor Communication Error\r\n&quot;</span>);</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">  <span class="keywordflow">default</span>:</div><div class="line">    printf(<span class="stringliteral">&quot;Unexpected error\r\n&quot;</span>);</div><div class="line">    <span class="keywordflow">break</span>;</div><div class="line">  }</div><div class="line">  <span class="comment">// add delay before polling for new value i.e same as measurement period </span></div><div class="line">  <span class="comment">// delay(); </span></div><div class="line">}</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>User should replace delay function with their own API.</dd>
<dd>
For a complete demonstration of the code snippets shown in this file using FreeRTOS, please refer to the ModusToolbox Code Example on pasco2.</dd></dl>
<p>Sensor measurement period configuration is optional, the default value inside the driver is 10 Seconds. The valid range is [10-4095] Seconds and can be changed using following code snippet.</p>
<div class="fragment"><div class="line"><span class="comment">// Optional configuration of CO2 measurement period, valid range is [10-4095] Seconds</span></div><div class="line"><a class="code" href="structmtb__pasco2__config__t.html">mtb_pasco2_config_t</a> pas_co2_config = { .<a class="code" href="structmtb__pasco2__config__t.html#ab171e9b70c2f37eaa2f853705142ef2e">measurement_period</a> = 10};</div><div class="line"></div><div class="line">result = <a class="code" href="group__group__pasco2__high__level.html#gabde6ae58d6210cc3d2c114387260850e">mtb_pasco2_set_config</a>(&amp;mtb_pasco2_context, &amp;pas_co2_config);</div><div class="line">CY_ASSERT(result == CY_RSLT_SUCCESS);</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>XENSIV™ PAS CO2 Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
